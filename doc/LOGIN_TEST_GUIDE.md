# 用户登录功能测试指南

## 功能说明

本项目已实现完整的用户登录功能，支持两种登录模式：

### 1. 开发模式（模拟数据登录）

- **配置位置**: `.env.dev` 文件中 `VITE_LOGIN_MODE = 'mock'`
- **登录方式**: 使用账号密码表单登录
- **测试账号**:
  - 管理员: username: `admin`, password: `111111`
  - 系统管理员: username: `system`, password: `111111`

### 2. 生产模式（OAuth2认证）

- **配置位置**: `.env.prod` 文件中 `VITE_LOGIN_MODE = 'oauth2'`
- **登录方式**: 点击按钮跳转到OAuth2认证中心
- **配置参数**: 需要在`.env`文件中配置OAuth2相关参数

## 测试步骤

### 测试开发模式（当前配置）

1. 确保 `.env.dev` 文件中 `VITE_LOGIN_MODE = 'mock'`
2. 启动开发服务器：`npm run dev`
3. 访问 `http://localhost:5173`
4. 系统会自动跳转到登录页面
5. 使用提供的测试账号登录
6. 登录成功后会跳转到首页

### 测试OAuth2模式

1. 修改 `.env.dev` 文件中 `VITE_LOGIN_MODE = 'oauth2'`
2. 配置OAuth2相关参数（VITE*OAUTH2*\*）
3. 重新启动开发服务器
4. 访问登录页面会显示OAuth2登录按钮
5. 点击按钮会跳转到配置的OAuth2认证地址

## 核心功能

### ✅ 已实现功能

1. **环境配置管理**

   - 支持开发/生产环境配置切换
   - OAuth2参数配置
   - 登录模式切换

2. **用户状态管理**

   - Pinia store管理用户状态
   - Token自动存储和恢复
   - 登录状态持久化

3. **API层设计**

   - 支持传统登录接口
   - 支持OAuth2登录接口
   - 自动Token刷新机制

4. **路由守卫**

   - 自动登录状态检查
   - 未登录自动跳转到登录页
   - OAuth2回调路由处理

5. **请求拦截器**

   - 自动添加Authorization头
   - Token过期自动刷新
   - 统一错误处理

6. **用户界面**
   - 响应式登录页面设计
   - 根据模式显示不同登录方式
   - 友好的错误提示

### 🔧 配置文件说明

- **`.env.dev`**: 开发环境配置
- **`.env.prod`**: 生产环境配置
- **`src/utils/env.ts`**: 环境配置工具类
- **`src/store/user.ts`**: 用户状态管理
- **`src/utils/request.ts`**: HTTP请求配置

## 脚本命令

- **`npm run dev`**: 启动开发服务器（使用dev模式）
- **`npm run build:dev`**: 构建开发版本
- **`npm run build:prod`**: 构建生产版本
- **`npm run build`**: 默认构建生产版本

## 使用建议

1. **开发阶段**: 使用mock模式快速开发和测试
2. **生产部署**: 切换到OAuth2模式对接实际认证系统
3. **安全考虑**: OAuth2模式包含state参数防止CSRF攻击
4. **Token管理**: 支持自动刷新，减少用户重复登录

## 故障排除

1. **TypeScript错误**: 项目使用了最新的Vue3和TypeScript，某些类型导入可能需要调整
2. **环境变量**: 确保`.env`文件中的变量名正确
3. **路由问题**: 检查路由守卫是否正确配置
4. **网络请求**: 确保API接口地址配置正确
